language: node_js

# set this variable to false to force Travis to build our app inside of a docker container!
sudo: false

node_js:
  - "6.9.0"
notifications:
  email:
    recipients:
      - bert@storied.co
      - abhilash@storied.co

# node_modules can be cached in between builds
cache:
  directories:
    - node_modules
    - vendor

# whitelist of branches that will trigger a build
branches:
  only:
    - master

# Install all dependencies.
install:
  - npm set progress=false
  - npm install -g @angular/cli@1.0.0-rc.2
  - npm install

# the actual build script. Compiles our app into a dist folder.
script:
  # build regular appshell
  #- ng build --prod
  - ng build

# Deploys the dist folder to S3
# This only gets pushed on tags, just like production builds.
# Todo, replace this with AWS CLI's S3 sync (so unused files are deleted)
deploy:
  - provider: s3
    skip_cleanup: true
    access_key_id: AKIAJMQ65MBQBJ5NXNSA
    secret_access_key: y/aQPdb74rmevwMStk6pHFOVkKtj2dC6H5jh8ntp
    local_dir: dist
    wait-until-deployed: false
    bucket: data-dashboard-dev.storied.co
    region: us-east-1
    on:
      branch: master
